Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJwZXJfY29kaWdvIjoxOTE0LCJzaXN0ZW1hcyI6W3sic2lzY2dlX2NvZGlnbyI6MjUsInNpc2NnZV9zaWdsYSI6InVhaSJ9LHsic2lzY2dlX2NvZGlnbyI6MjksInNpc2NnZV9zaWdsYSI6InBvYWkifSx7InNpc2NnZV9jb2RpZ28iOjMyLCJzaXNjZ2Vfc2lnbGEiOiJjb3JyZXNwb25kZW5jaWFfaW50ZXJuYSJ9LHsic2lzY2dlX2NvZGlnbyI6MzQsInNpc2NnZV9zaWdsYSI6InNpc3BvYSJ9LHsic2lzY2dlX2NvZGlnbyI6MzUsInNpc2NnZV9zaWdsYSI6ImZpX2NvbmF1ZCJ9LHsic2lzY2dlX2NvZGlnbyI6MzcsInNpc2NnZV9zaWdsYSI6ImNvbmF1ZCJ9XSwicm9sZXMiOlt7InNpc2NnZV9jb2RpZ28iOjI1LCJyb2xfY29kaWdvIjoxNTAsInJvbF9kZXNjcmlwY2lvbiI6IlJFVklTT1IgVUFJIn0seyJzaXNjZ2VfY29kaWdvIjoyOSwicm9sX2NvZGlnbyI6MTU4LCJyb2xfZGVzY3JpcGNpb24iOiJST0wgU1VQRVJWSVNJT04ifSx7InNpc2NnZV9jb2RpZ28iOjI5LCJyb2xfY29kaWdvIjoxNTcsInJvbF9kZXNjcmlwY2lvbiI6IlJPTCBSRUdJU1RSTyBSRUNVUlNPUyBIVU1BTk9TIn0seyJzaXNjZ2VfY29kaWdvIjoyOSwicm9sX2NvZGlnbyI6MTU2LCJyb2xfZGVzY3JpcGNpb24iOiJBRE1JTklTVFJBRE9SIFBPQUkifSx7InNpc2NnZV9jb2RpZ28iOjI5LCJyb2xfY29kaWdvIjoxNzMsInJvbF9kZXNjcmlwY2lvbiI6IlJPTCBQTEFOSUZJQ0FDScOTTiJ9LHsic2lzY2dlX2NvZGlnbyI6MzUsInJvbF9jb2RpZ28iOjE5Miwicm9sX2Rlc2NyaXBjaW9uIjoiVkFMSURBRE9SIn0seyJzaXNjZ2VfY29kaWdvIjozNCwicm9sX2NvZGlnbyI6MTk2LCJyb2xfZGVzY3JpcGNpb24iOiJHZXN0acOzbiBJbnN0aXR1Y2lvbmFsIn0seyJzaXNjZ2VfY29kaWdvIjozNCwicm9sX2NvZGlnbyI6MTkwLCJyb2xfZGVzY3JpcGNpb24iOiJPcGVyYWRvciBGb3JtdWxhcmlvIn0seyJzaXNjZ2VfY29kaWdvIjozNywicm9sX2NvZGlnbyI6MjAyLCJyb2xfZGVzY3JpcGNpb24iOiJBZG1pbmlzdHJhZG9yIENPTkFVRCJ9LHsic2lzY2dlX2NvZGlnbyI6MzcsInJvbF9jb2RpZ28iOjIwOCwicm9sX2Rlc2NyaXBjaW9uIjoiT3BlcmFkb3IgRm9ybXVsYXJpbyJ9LHsic2lzY2dlX2NvZGlnbyI6MzIsInJvbF9jb2RpZ28iOjE3NSwicm9sX2Rlc2NyaXBjaW9uIjoiRlVOQ0lPTkFSSU8ifSx7InNpc2NnZV9jb2RpZ28iOjM3LCJyb2xfY29kaWdvIjoyMTksInJvbF9kZXNjcmlwY2lvbiI6IkFwb3lvIn0seyJzaXNjZ2VfY29kaWdvIjozNywicm9sX2NvZGlnbyI6MjA5LCJyb2xfZGVzY3JpcGNpb24iOiJHZXN0acOzbiBJbnN0aXR1Y2lvbmFsIn0seyJzaXNjZ2VfY29kaWdvIjozNCwicm9sX2NvZGlnbyI6MTk4LCJyb2xfZGVzY3JpcGNpb24iOiJWZXJpZmljYWRvciBGb3JtdWxhcmlvIn0seyJzaXNjZ2VfY29kaWdvIjozNCwicm9sX2NvZGlnbyI6MTk3LCJyb2xfZGVzY3JpcGNpb24iOiJHZXN0acOzbiBJbnN0aXR1Y2lvbmFsIEFwcm9iYWRvciJ9LHsic2lzY2dlX2NvZGlnbyI6MzcsInJvbF9jb2RpZ28iOjIxMSwicm9sX2Rlc2NyaXBjaW9uIjoiVmVyaWZpY2Fkb3IgRm9ybXVsYXJpbyJ9XSwiaWQiOiJkN2UzOWQyYS0zYzhkLTRlMjMtYmI4Ny1kNWM1NTk5MWI0NjAiLCJ0aXBvIjoidXN1YXJpbyIsImlhdCI6MTcyMzc1MTExOSwiZXhwIjoxNzIzNzc5OTE5LCJtb21lbnQiOiIyMDI0LTA4LTE1VDE1OjQ1OjE5LTA0OjAwIn0.WKwNQQVQp8vFVw1uMBirCTPBJiDtiA0ERZOtiMgSmv2eFZxBBS_KcsOC54nM6FON45En3IiZt05A1jKj2BiGhQ


@LoggerMethod
async findCodigoConaudByActividad(query: GetAllActividadesDto, manager: EntityManager) {
  try {
    let sql = `
      SELECT
          a.act_codigo, a.act_estado,
          CASE
            WHEN a.act_estado = 2 AND iapd.iap_estado IN (2,8) THEN iad.iac_codigo_control_vista
            WHEN a.act_estado != 2 AND iapa.iap_estado IN (2,8) THEN iaa.iac_codigo_control_vista
            WHEN iapd.iap_estado IS NULL AND iapa.iap_estado IS NULL AND a.tipact_codigo = 2 THEN
                (
                  SELECT 	COALESCE(ia.iac_codigo_control_vista, '') AS codigo
                  FROM 	estructura_poa.actividades acc
                  LEFT JOIN estructura_poa.actividades_continuidad ac ON acc.act_codigo = ac.act_codigo AND ac.aco_estado != 0
                  LEFT JOIN ejecucion_actividades.inicios_actividades ia ON ac.iac_codigo = ia.iac_codigo
                  WHERE 	acc.act_codigo = a.act_codigo
                )
            ELSE ''
          END AS codigo_conaud
      FROM	estructura_poa.actividades a
          LEFT JOIN ejecucion_actividades.inicio_actividad_poa iapd ON a.act_codigo = iapd.act_codigo AND iapd.iap_estado NOT IN (0, 5)
          LEFT JOIN ejecucion_actividades.inicio_actividad_poa iapa ON a.act_codigo_anterior = iapa.act_codigo AND iapa.iap_estado NOT IN (0, 5)
          LEFT JOIN ejecucion_actividades.inicios_actividades iad ON iapd.iac_codigo = iad.iac_codigo
          LEFT JOIN ejecucion_actividades.inicios_actividades iaa ON iapa.iac_codigo = iaa.iac_codigo
      WHERE	TRUE
          ${query.act_codigo ? `AND  a.act_codigo IN ${query.act_codigo}` : ''}
      ORDER BY a.act_codigo DESC
      ;`;
    const resultQuery = await manager.query(sql);
    return CustomService.verifyingDataResult(resultQuery, this.message_custom);
  } catch (error) {
    this.logger.debug(error);
    throwError(400, error.message);
  }
}
